var express=require("express"),router=express.Router(),mysql=require("mysql"),client=mysql.createConnection({user:"root",password:"ehqps2m7"});router.get("/",function(e,t,r){t.json({result:"success"})}),router.post("/",function(e,t,r){t.json({title:e.body.title})}),router.post("/write/article",function(e,t,r){client.query("USE ucampus_db"),client.query("INSERT INTO articles(title, content, student_id) VALUES (?, ?, ?)",[e.body.title,e.body.content,e.body.nickname],function(r,n){r?t.sendStatus(400):client.query("SELECT id FROM articles WHERE student_id=? ORDER BY id DESC LIMIT 1",[e.body.nickname],function(e,r){t.send(r)})})}),router.post("/write/reply",function(e,t,r){client.query("USE ucampus"),client.query("UPDATE articles SET reply_count = reply_count + 1 WHERE id = ?",[e.body.id_article]),client.query("INSERT INTO replys(content, id_article) VALUES (?, ?)",[e.body.content,e.body.id_article],function(e,r){e?t.sendStatus(400):t.sendStatus(200)})}),router.get("/read/list",function(e,t,r){client.query("USE ucampus"),client.query("SELECT title, reply_count, view_count, DATE_FORMAT(date, '%Y.%m.%d') date, id FROM articles ORDER BY id DESC LIMIT ?, ?",[(e.query.page-1)*e.query.num,Number(e.query.num)],function(e,r){e?t.send(e):t.send(r)})}),router.get("/read/article",function(e,t,r){client.query("USE ucampus"),client.query("UPDATE articles SET view_count = view_count + 1 WHERE id = ?",[e.query.article_id]),client.query("SELECT title, view_count, reply_count, content, DATE_FORMAT(date, '%Y.%m.%d %H:%i') date FROM articles WHERE id = ?",[e.query.article_id],function(e,r){t.send(r)})}),router.get("/read/reply",function(e,t,r){client.query("USE ucampus"),client.query("SELECT DATE_FORMAT(date, '%Y.%m.%d %H:%i ') date, nickname, content from replys where id_article = ?",[e.query.id_article],function(e,r){t.send(r)})}),router.get("/delete/article",function(e,t,r){client.query("USE ucampus"),client.query("DELETE FROM articles WHERE id = ?",[e.query.article_id],function(e,t){})}),router.get("/delete/reply",function(e,t,r){client.query("USE ucampus"),client.query("DELETE FROM replys WHERE id = ?",[e.query.reply_id],function(e,t){})}),module.exports=router;
var Test=function(){this.testFunc=function(){console.log("this is a demo")}};exports.Test=Test;